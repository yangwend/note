## H5 移动端常见问题

### H5 端，部分安卓手机针对 Input 元素，页面上存在多个 Input 元素时，触发 onEnterPress，只有最后一个触发，中间的都没触发

这是典型的安卓 WebView/浏览器在软键盘回车事件上的兼容性问题：
部分安卓机在有多个 input 时，键盘回车不会触发中间那些输入框的 keypress/onPressEnter，只会触发最后一个，或者被表单提交/焦点切换等行为“吞掉”。

给你一套稳妥的修复方案（优先级从高到低），任选其一或组合使用：

1. 改用 onKeyDown 捕获回车，避免 onKeyPress/onEnterPress
   很多安卓机不会触发 keypress/onPressEnter，改用 keydown 最稳。
   同时避开中文输入法的组合输入阶段，用 isComposing 过滤。
   阻止默认行为和冒泡，避免被表单提交或父级事件“吞掉”。
   示例（React/TSX）：

如果是 antd/antd-mobile 的 Input，给最外层包一层，自己处理回车：

```tsx
const handleEnter = (e: React.KeyboardEvent<HTMLInputElement>, cb?: () => void) => {
  const ne = e.nativeEvent as any;
  const composing = ne.isComposing || ne.inputType === 'insertCompositionText';
  if (e.key === 'Enter' && !composing) {
    e.preventDefault();
    e.stopPropagation();
    cb?.();
  }
};

// 用法：每个输入框单独绑定，不要只在最后一个绑定
<input {...otherProps} onKeyDown={(e) => handleEnter(e, onEnterPress)} />;
```

注意：

不要依赖组件库的 onPressEnter（有些机型不触发），自己在 onKeyDown 里兜底。
保证每个 Input 都各自绑定 onKeyDown，不要只在最后一个绑定。

2. 使用捕获阶段 onKeyDownCapture，避免被子组件/表单抢先处理
   有的 UI 组件内部会在冒泡阶段处理并阻止事件，改用 capture 可以更早拿到事件。

```tsx
<input onKeyDownCapture={(e) => handleEnter(e, onEnterPress)} />
```

3. **设置 enterKeyHint 和 inputMode，提升安卓 IME 行为一致性**（目前使用该方式解决大部分场景）
   很多安卓键盘会根据 enterKeyHint 决定是否发出明确的 Enter 动作。

```tsx
<input
  enterKeyHint='done' // 可选：'done' | 'go' | 'next' | 'search' | 'send'
  inputMode='text'
/>
```

如果是“中间输入框希望 Enter 跳下一个”的场景，用 enterKeyHint="next" 并自己在 onKeyDown 中 focus 到下一个输入框。

4. 避免/规避 form 的默认提交
   如果这些 input 在同一个 form 里，安卓回车常常触发表单提交，导致只“触发一次”（常为最后一个）。
   方案：
   每个输入独立处理，不依赖 form 提交。
   或者把 form 的 onSubmit 里统一 e.preventDefault()，再分发给当前激活 input 的回调。
   如果必须使用 form，确保中间输入框的回车不提交：在该 input 的 onKeyDown 中阻止默认行为。

5. 兼容部分机型的“Search”/“Done”行为
   某些安卓只在 type="search" 下用“搜索”键派发特殊事件。如果你的输入语义确实是搜索框，可以改为 type="search" 并监听 onKeyDown。
   antd/antd-mobile 的 SearchBar 组件通常对安卓兼容性更好，可考虑替换纯 Input。

6. 处理中文输入法组合输入的边界
   使用 e.nativeEvent.isComposing 过滤组合中间态，避免半成品拼音时误触发。
   也可以额外监听 onCompositionEnd，在结束时检查是否应触发逻辑。

7. 排查清单（建议在真机/目标 WebView 上试）：

在有问题的中间 input 上打印 keydown/keypress/keyup，确认是否只有 keydown 到达。
确认是否处在 form 中且 form 提交了：在 form 的 onSubmit 打日志看看。
检查是否有父级/组件库在冒泡阶段 e.stopPropagation() 或阻止默认。
检查是否使用了 onPressEnter（很多安卓不会触发）。

### 参考链接

1. [H5 移动端常见问题](https://blog.csdn.net/qq_24182885/article/details/105481021)
